window.ZWaveNetworkAnalyticsLib=function(){function t(c,a){return c.length===a.length&&c.every(function(b,d){return b===a[d]})}function p(c){return c.reduce(function(a,b){return a+b},0)}function v(c){return c.filter(function(a,b,d){return d.indexOf(a)===b})}function u(c){c.sort(function(a,b){return a-b})}function n(c,a){this.src=c;this.h=a;this.w=[];this.m=this.A=0}function k(){this.links=[]}function q(c,a){this.src=c;this.h=a;this.c=[];this.B=this.s=this.K=this.N=this.l=0}function r(c){this.v=0;
this.path=c.slice()}function l(){this.u=[]}function g(c,a,b){this.a=c;this.g=a;this.ba=b||[];this.i=this.a.controller.data.nodeId.value;this.I=[];this.links=[];this.b=new k;this.j=new l;this.O=[];this.ga();this.ea();this.fa();this.da();this.ha()}n.prototype.use=function(c,a,b,d){this.A+=void 0!==d?d:1;b=127===b||void 0===b||-32<b&&125>b||-94>b?null:125===b?-94:126===b?-32:b;null!==b&&this.w.push(b)};n.prototype.C=function(){this.m++};n.prototype.usage=function(){return this.A};n.prototype.L=function(){return this.w};
k.prototype.use=function(c,a,b,d,e){this.f(c,a).use(c,a,b,e);this.f(a,c).use(c,a,d,0)};k.prototype.C=function(c,a){this.f(c,a).C()};k.prototype.M=function(c,a,b,d,e,f){var h=b.slice();h.unshift(c);c=b.slice();c.push(a);a=d?d.slice():void 0;b=e?e.slice():void 0;for(var m=0;m<h.length;m++)this.use(h[m],c[m],d?a[m]:void 0,e?b[m]:void 0,f)};k.prototype.f=function(c,a){var b=this.links.filter(function(d){return d.src==c&&d.h==a})[0];b||(b=new n(c,a),this.links.push(b));return b};k.prototype.usage=function(c,
a){var b=Math.max(0,Math.max.apply(null,this.links.map(function(e){return e.usage()}))),d=this.f(c,a).usage();return 0!==b?d/b:0};k.prototype.D=function(c,a){var b=this.f(c,a),d=b.usage();return 0!==d?b.m/d:0};k.prototype.L=function(c,a){var b;return(b=(b=this.f(c,a).w)?p(b)/b.length:void 0)?(b-0)/-100:0};q.prototype.send=function(c,a,b){var d=this.c.filter(function(e){return t(e.path,c)})[0];d||(d=new r(c),this.c.push(d));d.use();this.l++;this.K+=a;b&&this.N++};q.prototype.J=function(c,a){var b=
this.c.filter(function(d){return t(d.path,c)})[0];b||(b=new r(c),this.c.push(b));b.use();this.s++;this.B+=a?1:0};q.prototype.getStats=function(){var c=this.c.map(function(b){return b.path.length}),a=this.c.map(function(b){return b.path});return{minOutHops:Math.min.apply(null,c),maxOutHops:Math.max.apply(null,c),routes:a,retries:this.l?this.K/this.l:null,deliveryRate:this.l?this.N/this.l:null,sent:this.l,explores:this.s?this.B/this.s:null,received:this.s}};r.prototype.use=function(){this.v++};l.prototype.o=
function(c,a){var b=this.u.filter(function(d){return d.src==c&&d.h==a})[0];b||(b=new q(c,a),this.u.push(b));return b};l.prototype.send=function(c,a,b,d,e){this.o(c,a).send(b,d,e)};l.prototype.J=function(c,a,b,d){this.o(c,a).J(b,d)};l.prototype.Z=function(c,a){return this.o(c,a).c};l.prototype.H=function(c,a){return this.o(c,a).getStats()};l.prototype.G=function(c,a){var b=this.Z(c,a),d=new k;b.forEach(function(e){d.M(c,a,e.path,void 0,void 0,e.v)});return d};l.prototype.V=function(c){var a=0,b=0;
this.u.forEach(function(d){a+=p(d.c.map(function(e){return-1===e.path.indexOf(c)?0:e.v}));b+=p(d.c.map(function(e){return e.v}))});return b?a/b:0};l.prototype.F=function(c){var a=[];this.u.forEach(function(b){0<p(b.c.map(function(d){return-1===d.path.indexOf(c)?0:1}))&&a.push(b.h)});u(a);return a};g.prototype.ga=function(){var c=this;this.g.forEach(function(a){if(a.frameType&&(c.j.J(a.nodeId,c.i,a.hops||[],"Explore Frame"===a.frameType),a.hops)){var b=Array(a.hops.length+1);b[a.hops.length]=a.RSSI;
c.b.M(a.nodeId,c.i,a.hops,void 0,b,1)}});this.R=!1;this.g.forEach(function(a){!a.frameType&&a.hops&&(c.R=!0,c.j.send(c.i,a.nodeId,a.hops,a.tries-1,a.delivered),c.b.M(c.i,a.nodeId,a.hops,a.returnRSSI,void 0,1),0!=a.lastFailPath[0]&&c.b.C(a.lastFailPath[0],a.lastFailPath[1]))})};g.prototype.ea=function(){var c=this;for(a in this.a.devices){var a=parseInt(a,10);if(1!==this.a.devices[a].data.basicType.value){var b=a===this.i?"Controller":!1===this.a.devices[a].data.isListening.value?!0===this.a.devices[a].data.sensor250.value||
!0===this.a.devices[a].data.sensor1000.value?"FLiRS":"Sleeping":"Routing";this.I.push({id:a,usage:this.j.V(a),type:b,x:null,y:null,name:this.a.devices[a].data.givenName.value,dead:this.a.devices[a].data.isFailed.value});b=this.a.devices[a].data.neighbours.value.slice();var d=b.filter(function(f){return!!c.a.devices[f]});d.length!==b.length&&(console.log("Fixed neighbours for node "+a+" from "+b+" to "+d),b=d);for(var e in this.a.devices)e=parseInt(e,10),-1===b.indexOf(e)&&(this.a.devices[e]&&-1!==
this.a.devices[e].data.neighbours.value.indexOf(a)?(console.log("Adding asymmetrical route "+a+" -> "+e+" to official neighbour list"),b.push(e)):this.a.devices[e]&&1!==this.a.devices[e].data.basicType.value&&(0<this.b.usage(a,e)||0<this.b.usage(e,a))&&this.a.devices[e]&&(console.log("Adding actual route "+a+" -> "+e+" to official neighbour list"),b.push(e)));b.forEach(function(f){if(a!=f){var h=c.links.filter(function(m){return m.source==f&&m.target==a})[0];h?Object.assign(h,{rssi21:c.b.L(a,f),usage21:c.b.usage(a,
f),fails21:c.b.D(a,f)}):c.links.push({source:a,target:f,rssi12:c.b.L(a,f),usage12:c.b.usage(a,f),fails12:c.b.D(a,f)})}})}}};g.prototype.fa=function(){var c=this;this.I.map(function(a){var b=c.ba.filter(function(d){return d.id===a.id})[0];b&&(a.x=b.x,a.y=b.y)})};g.prototype.da=function(){for(c in this.a.devices){var c=parseInt(c,10);var a=[];var b=this.a.devices[c].instances,d;for(d in b){if(b[d].commandClasses[133])for(var e in b[d].commandClasses[133].data)e=parseInt(e,10),!isNaN(e)&&b[d].commandClasses[133].data[e].nodes.value&&
b[d].commandClasses[133].data[e].nodes.value.forEach(function(h){a.push(h)});if(b[d].commandClasses[142])for(e in b[d].commandClasses[142].data)if(e=parseInt(e,10),!isNaN(e)&&b[d].commandClasses[142].data[e].nodesInstances.value){var f=0;b[d].commandClasses[142].data[e].nodesInstances.value.forEach(function(h){0===f++%2&&a.push(h)})}}u(a);this.O[c]=v(a)}};g.prototype.ha=function(){var c=[],a=this.g[0]&&this.g[0].updateTime||0,b=this.g[0]&&this.g[0].updateTime||0;for(d in this.a.devices){var d=parseInt(d,
10);1!==this.a.devices[d].data.basicType.value&&c.push(d)}this.g.forEach(function(e){if(e.delivered||e.dstNodeId){var f=c.indexOf(e.nodeId);-1!==f&&c.splice(f,1)}a<e.updateTime&&(a=e.updateTime);b>e.updateTime&&(b=e.updateTime)});this.aa=c;this.ia=a;this.S=b;this.ca=this.g.length};g.prototype.U=function(c){return this.O[c]};g.prototype.W=function(){return this.I};g.prototype.T=function(){return this.links};g.prototype.P=function(){return this.i};g.prototype.$=function(c){return this.a.devices[c].data.isListening.value};
g.prototype.F=function(c){var a=this,b=this.P();return this.j.F(c).filter(function(d){return 1!==a.a.devices[d].data.basicType.value&&d!=b})};g.prototype.G=function(c,a){var b=this,d=this.j.G(c,a);d.links.forEach(function(e){e.m=b.b.f(e.src,e.h).m+b.b.f(e.h,e.src).m});return d};g.prototype.H=function(c,a){return this.j.H(c,a)};g.prototype.Y=function(c,a,b){return c.usage(a,b)};g.prototype.X=function(c,a,b){return c.D(a,b)};g.prototype.getStats=function(){return{haveIMA:this.R,nodeNoStatistics:this.aa,
startStatistics:this.ia,endStatistics:this.S,packetsCount:this.ca}};return g}();window.ZWaveNetworkAnalyticsLib.prototype.getNodes=window.ZWaveNetworkAnalyticsLib.prototype.W;window.ZWaveNetworkAnalyticsLib.prototype.getLinks=window.ZWaveNetworkAnalyticsLib.prototype.T;window.ZWaveNetworkAnalyticsLib.prototype.getMyNodeId=window.ZWaveNetworkAnalyticsLib.prototype.P;window.ZWaveNetworkAnalyticsLib.prototype.isListening=window.ZWaveNetworkAnalyticsLib.prototype.$;
window.ZWaveNetworkAnalyticsLib.prototype.getNodeAssociations=window.ZWaveNetworkAnalyticsLib.prototype.U;window.ZWaveNetworkAnalyticsLib.prototype.getNodesRoutedFor=window.ZWaveNetworkAnalyticsLib.prototype.F;window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryLinkMap=window.ZWaveNetworkAnalyticsLib.prototype.G;window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryStats=window.ZWaveNetworkAnalyticsLib.prototype.H;window.ZWaveNetworkAnalyticsLib.prototype.getStatUsage=window.ZWaveNetworkAnalyticsLib.prototype.Y;
window.ZWaveNetworkAnalyticsLib.prototype.getStatFailRate=window.ZWaveNetworkAnalyticsLib.prototype.X;window.ZWaveNetworkAnalyticsLib.prototype.getStats=window.ZWaveNetworkAnalyticsLib.prototype.getStats;