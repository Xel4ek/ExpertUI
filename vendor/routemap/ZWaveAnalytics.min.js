window.ZWaveNetworkAnalyticsLib=function(){function p(c,a){return c.length===a.length&&c.every(function(b,c){return b===a[c]})}function l(c){return c.reduce(function(a,b){return a+b},0)}function r(c){return c.filter(function(a,b,c){return c.indexOf(a)===b})}function q(c){c.sort(function(a,b){return a-b})}function k(c,a){this.src=c;this.i=a;this.A=[];this.m=this.B=0}function g(){this.links=[]}function m(c,a){this.src=c;this.i=a;this.c=[];this.C=this.o=this.u=this.M=this.h=0}function n(c){this.w=0;
this.path=c.slice()}function h(){this.v=[]}function f(c,a,b){this.a=c;this.g=a;this.Z=b||[];this.j=this.a.controller.data.nodeId.value;this.I=[];this.links=[];this.b=new g;this.l=new h;this.N=[];this.da();this.ba();this.ca();this.aa();this.ea()}k.prototype.use=function(c,a,b,d){this.B+=void 0!==d?d:1;b=127===b||void 0===b||-32<b&&125>b||-94>b?null:125===b?-94:126===b?-32:b;null!==b&&this.A.push(b)};k.prototype.D=function(){this.m++};k.prototype.usage=function(){return this.B};k.prototype.K=function(){return this.A};
g.prototype.use=function(c,a,b,d,e){this.f(c,a).use(c,a,b,e);this.f(a,c).use(c,a,d,0)};g.prototype.D=function(c,a){this.f(c,a).D()};g.prototype.L=function(c,a,b,d,e,t){var f=b.slice();f.unshift(c);c=b.slice();c.push(a);a=d?d.slice():void 0;b=e?e.slice():void 0;for(var g=0;g<f.length;g++)this.use(f[g],c[g],d?a[g]:void 0,e?b[g]:void 0,t)};g.prototype.f=function(c,a){var b=this.links.filter(function(b){return b.src==c&&b.i==a})[0];b||(b=new k(c,a),this.links.push(b));return b};g.prototype.usage=function(c,
a){var b=Math.max(0,Math.max.apply(null,this.links.map(function(a){return a.usage()}))),d=this.f(c,a).usage();return 0!==b?d/b:0};g.prototype.O=function(c,a){var b=this.f(c,a),d=b.usage();return 0!==d?b.m/d:0};g.prototype.K=function(c,a){var b;return(b=(b=this.f(c,a).A)?l(b)/b.length:void 0)?(b-0)/-100:0};m.prototype.send=function(c,a,b){var d=this.c.filter(function(a){return p(a.path,c)})[0];d||(d=new n(c),this.c.push(d));d.use();this.h++;this.u+=a;b&&this.M++};m.prototype.J=function(c,a){var b=
this.c.filter(function(a){return p(a.path,c)})[0];b||(b=new n(c),this.c.push(b));b.use();this.o++;this.C+=a?1:0};m.prototype.getStats=function(){var c=this.c.map(function(a){return a.path.length}),a=this.c.map(function(a){return a.path});return{ja:Math.min.apply(null,c),ia:Math.max.apply(null,c),c:a,u:this.h?this.u/this.h:null,ga:this.h?this.M/this.h:null,h:this.h,ha:this.o?this.C/this.o:null,o:this.o}};n.prototype.use=function(){this.w++};h.prototype.s=function(c,a){var b=this.v.filter(function(b){return b.src==
c&&b.i==a})[0];b||(b=new m(c,a),this.v.push(b));return b};h.prototype.send=function(c,a,b,d,e){this.s(c,a).send(b,d,e)};h.prototype.J=function(c,a,b,d){this.s(c,a).J(b,d)};h.prototype.X=function(c,a){return this.s(c,a).c};h.prototype.H=function(c,a){return this.s(c,a).getStats()};h.prototype.G=function(c,a){var b=this.X(c,a),d=new g;b.forEach(function(b){d.L(c,a,b.path,void 0,void 0,b.w)});return d};h.prototype.V=function(c){var a=0,b=0;this.v.forEach(function(d){a+=l(d.c.map(function(a){return-1===
a.path.indexOf(c)?0:a.w}));b+=l(d.c.map(function(a){return a.w}))});return b?a/b:0};h.prototype.F=function(c){var a=[];this.v.forEach(function(b){0<l(b.c.map(function(a){return-1===a.path.indexOf(c)?0:1}))&&a.push(b.i)});q(a);return a};f.prototype.da=function(){var c=this;this.g.forEach(function(a){if(a.frameType&&(c.l.J(a.nodeId,c.j,a.hops||[],"Explore Frame"===a.frameType),a.hops)){var b=Array(a.hops.length+1);b[a.hops.length]=a.RSSI;c.b.L(a.nodeId,c.j,a.hops,void 0,b,1)}});this.R=!1;this.g.forEach(function(a){!a.frameType&&
a.hops&&(c.R=!0,c.l.send(c.j,a.nodeId,a.hops,a.tries-1,a.delivered),c.b.L(c.j,a.nodeId,a.hops,a.returnRSSI,void 0,1),0!=a.lastFailPath[0]&&c.b.D(a.lastFailPath[0],a.lastFailPath[1]))})};f.prototype.ba=function(){var c=this;for(a in this.a.devices){var a=parseInt(a,10);if(1!==this.a.devices[a].data.basicType.value){var b=a===this.j?"Controller":!1===this.a.devices[a].data.isListening.value?!0===this.a.devices[a].data.sensor250.value||!0===this.a.devices[a].data.sensor1000.value?"FLiRS":"Sleeping":
"Routing";this.I.push({id:a,usage:this.l.V(a),type:b,x:null,y:null,name:this.a.devices[a].data.givenName.value,dead:this.a.devices[a].data.isFailed.value});b=this.a.devices[a].data.neighbours.value.slice();var d=b.filter(function(a){return!!c.a.devices[a]});d.length!==b.length&&(console.log("Fixed neighbours for node "+a+" from "+b+" to "+d),b=d);for(var e in this.a.devices)e=parseInt(e,10),-1===b.indexOf(e)&&(this.a.devices[e]&&-1!==this.a.devices[e].data.neighbours.value.indexOf(a)?(console.log("Adding asymmetrical route "+
a+" -> "+e+" to official neighbour list"),b.push(e)):this.a.devices[e]&&1!==this.a.devices[e].data.basicType.value&&(0<this.b.usage(a,e)||0<this.b.usage(e,a))&&this.a.devices[e]&&(console.log("Adding actual route "+a+" -> "+e+" to official neighbour list"),b.push(e)));b.forEach(function(b){if(a!=b){var d=c.links.filter(function(c){return c.source==b&&c.target==a})[0];d?Object.assign(d,{rssi21:c.b.K(a,b),usage21:c.b.usage(a,b),fails21:c.b.O(a,b)}):c.links.push({source:a,target:b,rssi12:c.b.K(a,b),
usage12:c.b.usage(a,b),fails12:c.b.O(a,b)})}})}}};f.prototype.ca=function(){var c=this;this.I.map(function(a){var b=c.Z.filter(function(b){return b.id===a.id})[0];b&&(a.x=b.x,a.y=b.y)})};f.prototype.aa=function(){for(c in this.a.devices){var c=parseInt(c,10);var a=[];var b=this.a.devices[c].instances,d;for(d in b){if(b[d].commandClasses[133])for(var e in b[d].commandClasses[133].data)e=parseInt(e,10),!isNaN(e)&&b[d].commandClasses[133].data[e].nodes.value&&b[d].commandClasses[133].data[e].nodes.value.forEach(function(b){a.push(b)});
if(b[d].commandClasses[142])for(e in b[d].commandClasses[142].data)if(e=parseInt(e,10),!isNaN(e)&&b[d].commandClasses[142].data[e].nodesInstances.value){var f=0;b[d].commandClasses[142].data[e].nodesInstances.value.forEach(function(b){0===f++%2&&a.push(b)})}}q(a);this.N[c]=r(a)}};f.prototype.ea=function(){var c=[],a=this.g[0]&&this.g[0].updateTime||0,b=this.g[0]&&this.g[0].updateTime||0;for(d in this.a.devices){var d=parseInt(d,10);1!==this.a.devices[d].data.basicType.value&&c.push(d)}this.g.forEach(function(d){if(d.delivered||
d.dstNodeId){var e=c.indexOf(d.nodeId);-1!==e&&c.splice(e,1)}a<d.updateTime&&(a=d.updateTime);b>d.updateTime&&(b=d.updateTime)});this.Y=c;this.fa=a;this.S=b;this.$=this.g.length};f.prototype.U=function(c){return this.N[c]};f.prototype.W=function(){return this.I};f.prototype.T=function(){return this.links};f.prototype.P=function(){return this.j};f.prototype.F=function(c){var a=this,b=this.P();return this.l.F(c).filter(function(c){return 1!==a.a.devices[c].data.basicType.value&&c!=b})};f.prototype.G=
function(c,a){var b=this,d=this.l.G(c,a);d.links.forEach(function(a){a.m=b.b.f(a.src,a.i).m+b.b.f(a.i,a.src).m});return d};f.prototype.H=function(c,a){return this.l.H(c,a)};f.prototype.getStats=function(){return{haveIMA:this.R,nodeNoStatistics:this.Y,startStatistics:this.fa,endStatistics:this.S,packetsCount:this.$}};return f}();window.ZWaveNetworkAnalyticsLib.prototype.getNodes=window.ZWaveNetworkAnalyticsLib.prototype.W;window.ZWaveNetworkAnalyticsLib.prototype.getLinks=window.ZWaveNetworkAnalyticsLib.prototype.T;
window.ZWaveNetworkAnalyticsLib.prototype.getMyNodeId=window.ZWaveNetworkAnalyticsLib.prototype.P;window.ZWaveNetworkAnalyticsLib.prototype.getNodeAssociations=window.ZWaveNetworkAnalyticsLib.prototype.U;window.ZWaveNetworkAnalyticsLib.prototype.getNodesRoutedFor=window.ZWaveNetworkAnalyticsLib.prototype.F;window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryLinkMap=window.ZWaveNetworkAnalyticsLib.prototype.G;window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryStats=window.ZWaveNetworkAnalyticsLib.prototype.H;
window.ZWaveNetworkAnalyticsLib.prototype.getStats=window.ZWaveNetworkAnalyticsLib.prototype.getStats;