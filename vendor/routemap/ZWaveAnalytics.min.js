window.ZWaveNetworkAnalyticsLib=function(){function t(b,a){return b.length===a.length&&b.every(function(c,d){return c===a[d]})}function p(b){return b.reduce(function(a,c){return a+c},0)}function v(b){return b.filter(function(a,c,d){return d.indexOf(a)===c})}function u(b){b.sort(function(a,c){return a-c})}function n(b,a){this.src=b;this.i=a;this.A=[];this.o=this.B=0}function k(){this.links=[]}function q(b,a){this.src=b;this.i=a;this.f=[];this.C=this.u=this.L=this.O=this.m=0}function r(b){this.w=0;
this.path=b.slice()}function l(){this.v=[]}function g(b,a,c){this.a=b;this.h=a;this.ea=c||[];this.j=this.a.controller.data.nodeId.value;this.J=[];this.links=[];this.b=new k;this.l=new l;this.P=[];this.ka();this.ha();this.ia();this.ga();this.la();this.ja()}n.prototype.use=function(b,a,c,d){this.B+=void 0!==d?d:1;c=127===c||void 0===c||-32<c&&125>c||-94>c?null:125===c?-94:126===c?-32:c;null!==c&&this.A.push(c)};n.prototype.D=function(){this.o++};n.prototype.usage=function(){return this.B};n.prototype.M=
function(){return this.A};k.prototype.use=function(b,a,c,d,e){this.g(b,a).use(b,a,c,e);this.g(a,b).use(b,a,d,0)};k.prototype.D=function(b,a){this.g(b,a).D()};k.prototype.N=function(b,a,c,d,e,f){var h=c.slice();h.unshift(b);b=c.slice();b.push(a);a=d?d.slice():void 0;c=e?e.slice():void 0;for(var m=0;m<h.length;m++)this.use(h[m],b[m],d?a[m]:void 0,e?c[m]:void 0,f)};k.prototype.g=function(b,a){var c=this.links.filter(function(d){return d.src==b&&d.i==a})[0];c||(c=new n(b,a),this.links.push(c));return c};
k.prototype.usage=function(b,a){var c=Math.max(0,Math.max.apply(null,this.links.map(function(e){return e.usage()}))),d=this.g(b,a).usage();return 0!==c?d/c:0};k.prototype.F=function(b,a){var c=this.g(b,a),d=c.usage();return 0!==d?c.o/d:0};k.prototype.M=function(b,a){var c;return(c=(c=this.g(b,a).A)?p(c)/c.length:void 0)?(c-0)/-100:0};q.prototype.send=function(b,a,c){var d=this.f.filter(function(e){return t(e.path,b)})[0];d||(d=new r(b),this.f.push(d));d.use();this.m++;this.L+=a;c&&this.O++};q.prototype.K=
function(b,a){var c=this.f.filter(function(d){return t(d.path,b)})[0];c||(c=new r(b),this.f.push(c));c.use();this.u++;this.C+=a?1:0};q.prototype.getStats=function(){var b=this.f.map(function(c){return c.path.length}),a=this.f.map(function(c){return c.path});return{minOutHops:Math.min.apply(null,b),maxOutHops:Math.max.apply(null,b),routes:a,retries:this.m?this.L/this.m:null,deliveryRate:this.m?this.O/this.m:null,sent:this.m,explores:this.u?this.C/this.u:null,received:this.u}};r.prototype.use=function(){this.w++};
l.prototype.s=function(b,a){var c=this.v.filter(function(d){return d.src==b&&d.i==a})[0];c||(c=new q(b,a),this.v.push(c));return c};l.prototype.send=function(b,a,c,d,e){this.s(b,a).send(c,d,e)};l.prototype.K=function(b,a,c,d){this.s(b,a).K(c,d)};l.prototype.aa=function(b,a){return this.s(b,a).f};l.prototype.I=function(b,a){return this.s(b,a).getStats()};l.prototype.H=function(b,a){var c=this.aa(b,a),d=new k;c.forEach(function(e){d.N(b,a,e.path,void 0,void 0,e.w)});return d};l.prototype.X=function(b){var a=
0,c=0;this.v.forEach(function(d){a+=p(d.f.map(function(e){return-1===e.path.indexOf(b)?0:e.w}));c+=p(d.f.map(function(e){return e.w}))});return c?a/c:0};l.prototype.G=function(b){var a=[];this.v.forEach(function(c){0<p(c.f.map(function(d){return-1===d.path.indexOf(b)?0:1}))&&a.push(c.i)});u(a);return a};g.prototype.ka=function(){var b=this;this.h.forEach(function(a){if(a.frameType&&(b.l.K(a.nodeId,b.j,a.hops||[],"Explore Frame"===a.frameType),a.hops)){var c=Array(a.hops.length+1);c[a.hops.length]=
a.RSSI;b.b.N(a.nodeId,b.j,a.hops,void 0,c,1)}});this.T=!1;this.h.forEach(function(a){!a.frameType&&a.hops&&(b.T=!0,b.l.send(b.j,a.nodeId,a.hops,a.tries-1,a.delivered),b.b.N(b.j,a.nodeId,a.hops,a.returnRSSI,void 0,1),0!=a.lastFailPath[0]&&b.b.D(a.lastFailPath[0],a.lastFailPath[1]))})};g.prototype.ha=function(){var b=this;for(a in this.a.devices){var a=parseInt(a,10);if(1!==this.a.devices[a].data.basicType.value){var c=a===this.j?"Controller":!1===this.a.devices[a].data.isListening.value?!0===this.a.devices[a].data.sensor250.value||
!0===this.a.devices[a].data.sensor1000.value?"FLiRS":"Sleeping":"Routing";this.J.push({id:a,usage:this.l.X(a),type:c,x:null,y:null,name:this.a.devices[a].data.givenName.value,dead:this.a.devices[a].data.isFailed.value});c=this.a.devices[a].data.neighbours.value.slice();var d=c.filter(function(f){return!!b.a.devices[f]});d.length!==c.length&&(console.log("Fixed neighbours for node "+a+" from "+c+" to "+d),c=d);for(var e in this.a.devices)e=parseInt(e,10),-1===c.indexOf(e)&&(this.a.devices[e]&&-1!==
this.a.devices[e].data.neighbours.value.indexOf(a)?(console.log("Adding asymmetrical route "+a+" -> "+e+" to official neighbour list"),c.push(e)):this.a.devices[e]&&1!==this.a.devices[e].data.basicType.value&&(0<this.b.usage(a,e)||0<this.b.usage(e,a))&&this.a.devices[e]&&(console.log("Adding actual route "+a+" -> "+e+" to official neighbour list"),c.push(e)));c.forEach(function(f){if(a!=f){var h=b.links.filter(function(m){return m.source==f&&m.target==a})[0];h?Object.assign(h,{rssi21:b.b.M(a,f),usage21:b.b.usage(a,
f),fails21:b.b.F(a,f)}):b.links.push({source:a,target:f,rssi12:b.b.M(a,f),usage12:b.b.usage(a,f),fails12:b.b.F(a,f)})}})}}};g.prototype.ia=function(){var b=this;this.J.map(function(a){var c=b.ea.filter(function(d){return d.id===a.id})[0];c&&(a.x=c.x,a.y=c.y)})};g.prototype.ga=function(){for(b in this.a.devices){var b=parseInt(b,10);var a=[];var c=this.a.devices[b].instances,d;for(d in c){if(c[d].commandClasses[133])for(var e in c[d].commandClasses[133].data)e=parseInt(e,10),!isNaN(e)&&c[d].commandClasses[133].data[e].nodes.value&&
c[d].commandClasses[133].data[e].nodes.value.forEach(function(h){a.push(h)});if(c[d].commandClasses[142])for(e in c[d].commandClasses[142].data)if(e=parseInt(e,10),!isNaN(e)&&c[d].commandClasses[142].data[e].nodesInstances.value){var f=0;c[d].commandClasses[142].data[e].nodesInstances.value.forEach(function(h){0===f++%2&&a.push(h)})}}u(a);this.P[b]=v(a)}};g.prototype.la=function(){var b=[],a=this.h[0]&&this.h[0].updateTime||0,c=this.h[0]&&this.h[0].updateTime||0;for(d in this.a.devices){var d=parseInt(d,
10);1!==this.a.devices[d].data.basicType.value&&b.push(d)}this.h.forEach(function(e){if(e.delivered||e.dstNodeId){var f=b.indexOf(e.nodeId);-1!==f&&b.splice(f,1)}a<e.updateTime&&(a=e.updateTime);c>e.updateTime&&(c=e.updateTime)});this.da=b;this.ma=a;this.U=c;this.fa=this.h.length};g.prototype.ja=function(){var b=[];for(a in this.a.devices){var a=parseInt(a,10);b[a]||(b[a]=[]);if(this.a.devices[a].data.c)for(var c in this.a.devices[a].data.c)if(c=parseInt(c,10),!isNaN(c)){for(var d=this.a.devices[a].data.c[c].value,
e=[],f=0;4>f&&0!==d[f];f++)232<d[f]&&(e=null),e.push(d[f]);if(null===e)break;b[a][c]=e}}this.c=b};g.prototype.W=function(b){return this.P[b]};g.prototype.Y=function(){return this.J};g.prototype.V=function(){return this.links};g.prototype.R=function(){return this.j};g.prototype.ba=function(b){return this.a.devices[b].data.isListening.value};g.prototype.G=function(b){var a=this,c=this.R();return this.l.G(b).filter(function(d){return 1!==a.a.devices[d].data.basicType.value&&d!=c})};g.prototype.H=function(b,
a){var c=this,d=this.l.H(b,a);d.links.forEach(function(e){e.o=c.b.g(e.src,e.i).o+c.b.g(e.i,e.src).o});return d};g.prototype.I=function(b,a){return this.l.I(b,a)};g.prototype.ca=function(b,a,c){b=this.S(b)[a];if(!b||b.length!=c.length)return!1;for(a=0;a<b.length;a++)if(b[a]!==c[a])return!1;return!0};g.prototype.S=function(b){return this.c[b]?this.c[b].slice().map(function(a){return a.slice()}):[]};g.prototype.na=function(b,a,c){c?(this.c[b]||(this.c[b]=[]),this.c[b][a]=c):this.c[b]&&delete this.c[b][a]};
g.prototype.$=function(b,a,c){return b.usage(a,c)};g.prototype.Z=function(b,a,c){return b.F(a,c)};g.prototype.getStats=function(){return{haveIMA:this.T,nodeNoStatistics:this.da,startStatistics:this.ma,endStatistics:this.U,packetsCount:this.fa}};return g}();window.ZWaveNetworkAnalyticsLib.prototype.getNodes=window.ZWaveNetworkAnalyticsLib.prototype.Y;window.ZWaveNetworkAnalyticsLib.prototype.getLinks=window.ZWaveNetworkAnalyticsLib.prototype.V;
window.ZWaveNetworkAnalyticsLib.prototype.getMyNodeId=window.ZWaveNetworkAnalyticsLib.prototype.R;window.ZWaveNetworkAnalyticsLib.prototype.isListening=window.ZWaveNetworkAnalyticsLib.prototype.ba;window.ZWaveNetworkAnalyticsLib.prototype.getNodeAssociations=window.ZWaveNetworkAnalyticsLib.prototype.W;window.ZWaveNetworkAnalyticsLib.prototype.getNodesRoutedFor=window.ZWaveNetworkAnalyticsLib.prototype.G;window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryLinkMap=window.ZWaveNetworkAnalyticsLib.prototype.H;
window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryStats=window.ZWaveNetworkAnalyticsLib.prototype.I;window.ZWaveNetworkAnalyticsLib.prototype.isPriorityRoute=window.ZWaveNetworkAnalyticsLib.prototype.ca;window.ZWaveNetworkAnalyticsLib.prototype.getPriorityRoutes=window.ZWaveNetworkAnalyticsLib.prototype.S;window.ZWaveNetworkAnalyticsLib.prototype.updatePriorityRoutes=window.ZWaveNetworkAnalyticsLib.prototype.na;window.ZWaveNetworkAnalyticsLib.prototype.getStatUsage=window.ZWaveNetworkAnalyticsLib.prototype.$;
window.ZWaveNetworkAnalyticsLib.prototype.getStatFailRate=window.ZWaveNetworkAnalyticsLib.prototype.Z;window.ZWaveNetworkAnalyticsLib.prototype.getStats=window.ZWaveNetworkAnalyticsLib.prototype.getStats;